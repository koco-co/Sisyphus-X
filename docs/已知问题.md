# Sisyphus-X 已知问题清单

**当前版本**: v1.1.0-beta
**最后更新**: 2026-02-15 22:30
**维护人**: @pm

---

## 📊 问题统计

- **CRITICAL**: 0 个 ✅
- **HIGH**: 0 个 ✅
- **MEDIUM**: 3 个
- **LOW**: 3 个
- **总计**: 6 个

---

## 🔴 CRITICAL (无)

*所有 CRITICAL 问题已修复!*

---

## 🟠 HIGH (无)

*无 HIGH 级别问题*

---

## 🟡 MEDIUM

### MEDIUM-001: 前端 Token 存储安全性不足

**问题描述**:

当前前端 JWT Token 存储在 `localStorage` 中,存在 XSS 攻击风险。

**影响范围**:

- 所有已登录用户
- 涉及文件: `frontend/src/api/client.ts`

**安全风险**:

- XSS 攻击可窃取 Token
- CSRF 攻击风险较低 (需要 SameSite Cookie)

**计划解决方案**:

1. **短期方案** (v1.2.0):
   - 添加 httpOnly Cookie 支持
   - localStorage → httpOnly Cookie
   - 后端添加 Cookie 认证依赖

2. **长期方案** (v1.3.0):
   - 实现 Token 刷新机制
   - Access Token (内存) + Refresh Token (httpOnly Cookie)
   - 减少 Token 泄露风险

**负责人**: @backend-dev, @frontend-dev
**预估工时**: 3 天
**目标版本**: v1.2.0

**参考链接**:
- [OWASP Token Storage Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.html)
- [Stop using JWT for sessions](http://cryto.net/~joep/blog/stop-using-jwt-for-sessions.html)

---

### MEDIUM-002: WebSocket 心跳间隔可优化

**问题描述**:

当前 WebSocket 心跳间隔为 15 秒,可能导致不必要的连接开销。

**影响范围**:

- 测试执行实时推送
- 涉及文件: `backend/app/api/v1/endpoints/execution.py`

**性能影响**:

- 频繁心跳增加服务器负载
- 高并发场景下可能影响性能

**计划解决方案**:

1. 调整心跳间隔为 30 秒
2. 添加自适应心跳机制 (根据网络状况调整)
3. 优化断线重连逻辑

**负责人**: @backend-dev
**预估工时**: 0.5 天
**目标版本**: v1.1.1 (补丁版本)

**参考**:
- 当前配置: `heartbeat_interval = 15`
- 建议配置: `heartbeat_interval = 30`

---

### MEDIUM-003: 测试用例模型定义不匹配 ✨ 新增

**发现时间**: 2026-02-15
**发现人**: @architect
**优先级**: 🟡 MEDIUM (影响测试通过率)

**问题描述**:

测试用例中使用了错误的 Project 模型定义,导致 39 个测试失败。

**错误详情**:

- 测试用例使用了 `key` 和 `owner` 字段
- 实际模型使用 `created_by` 字段 (外键)
- conftest.py 只导入了 3 个模型,缺少其他模型

**影响范围**:

- 🟡 **39 个测试失败** (不是之前报告的 83 个)
- 🟡 影响测试覆盖率验证
- 🟡 影响开发进度

**真实原因**:

1. **conftest.py 模型导入不完整** (已修复 ✅)
   ```python
   # 修复前: 只导入 3 个模型
   # 修复后: 导入所有需要的模型
   ```

2. **测试用例字段定义错误**
   ```python
   # 错误: project.key, project.owner
   # 正确: project.created_by
   ```

**解决方案**:

1. ✅ **已完成**: conftest.py 已更新,导入所有模型
2. ⏳ **进行中**: @whitebox-qa 修复 39 个测试用例
3. ⏳ **待完成**: 重新运行测试验证

**负责人**: @whitebox-qa
**预估工时**: 2 小时
**目标版本**: v1.1.1 (紧急补丁)

**参考**:
- 架构师审查: @architect (2026-02-15)
- 影响测试: TASK-043 ~ TASK-047
- 测试报告: @whitebox-qa

**状态**: 🚧 修复中

**历史记录**:
- ~~CRITICAL-001: checkpointer.py 缺少 Optional 导入~~ → ✅ 已修复 (实际不存在)
- ~~CRITICAL-002: llm_service.py 缺少 Optional 导入~~ → ✅ 已修复 (实际不存在)

---

## 🟢 LOW

### LOW-001: 部分模型仍使用 SQLModel

**问题描述**:

项目中部分模型使用 SQLModel,部分使用 SQLAlchemy 2.0,不一致。

**影响范围**:

- `backend/app/models/` 下所有模型
- 代码风格不统一

**技术债务**:

- SQLModel 基于 SQLAlchemy 1.x,不是最新版本
- 类型注解方式不统一
- 未来维护成本增加

**计划解决方案**:

1. **短期** (v1.2.0):
   - 新模型全部使用 SQLAlchemy 2.0
   - 使用 `Mapped[]` 类型注解

2. **长期** (v1.3.0):
   - 逐步迁移旧模型到 SQLAlchemy 2.0
   - 统一代码风格

**负责人**: @backend-dev
**预估工时**: 2 周
**目标版本**: v1.3.0

**迁移优先级**:
1. 高频使用的模型 (User, Project)
2. 中频使用的模型 (Interface, Scenario)
3. 低频使用的模型 (其他)

---

### LOW-002: 前端错误提示不够友好

**问题描述**:

当前前端错误提示直接显示后端错误信息,不够用户友好。

**影响范围**:

- 所有前端页面的错误提示
- 涉及文件: `frontend/src/api/client.ts`

**用户体验问题**:

- 技术术语用户不理解
- 错误信息不够明确
- 缺少解决建议

**计划解决方案**:

1. 创建错误码映射表
2. 统一错误处理逻辑
3. 提供用户友好的错误提示
4. 添加错误解决建议

**负责人**: @frontend-dev
**预估工时**: 2 天
**目标版本**: v1.2.0

**示例**:

| 错误码 | 原始错误 | 友好提示 | 解决建议 |
|--------|----------|----------|----------|
| AUTH_001 | Token missing | 登录已过期,请重新登录 | 点击跳转到登录页 |
| PROJ_004 | Connection refused | 数据库连接失败 | 请检查数据库配置 |

---

### LOW-003: Docker Compose 配置缺失

**问题描述**:

项目中 `docker-compose.yml` 文件被删除,新开发者无法快速启动环境。

**影响范围**:

- 开发环境搭建
- 本地测试环境

**影响**:

- 新人上手困难
- 环境配置不统一
- 测试环境部署复杂

**计划解决方案**:

1. 恢复 `docker-compose.yml`
2. 添加 `docker-compose.dev.yml` (开发环境)
3. 添加 `docker-compose.test.yml` (测试环境)
4. 更新 README 启动说明

**负责人**: @architect, @backend-dev
**预估工时**: 1 天
**目标版本**: v1.1.1 (补丁版本)

**包含服务**:
- PostgreSQL 15
- Redis 7
- MinIO (最新版)

---

## 📝 问题处理流程

### 问题报告

1. **发现问题**: 任何团队成员
2. **提交问题**: GitHub Issues 或团队会议
3. **评估影响**: @pm + @architect
4. **分配优先级**: CRITICAL > HIGH > MEDIUM > LOW

### 问题修复

1. **认领问题**: 负责人主动认领
2. **制定方案**: 2 天内提交解决方案
3. **评审方案**: 团队评审通过后实施
4. **修复验证**: 开发 + 测试验证

### 问题关闭

1. **验证通过**: 测试通过
2. **代码审查**: @pr-reviewer 审查通过
3. **文档更新**: 更新相关文档
4. **关闭问题**: 更新本文件

---

## 🎯 近期修复计划

### Sprint 1 (2026-02-15 ~ 2026-02-22)

- [ ] MEDIUM-003: 修复测试用例模型定义 (39 个测试)
- [ ] LOW-003: 恢复 Docker Compose 配置
- [ ] MEDIUM-002: 优化 WebSocket 心跳

### Sprint 2 (2026-02-22 ~ 2026-03-01)

- [ ] LOW-002: 优化前端错误提示

### Sprint 3 (2026-03-01 ~ 2026-03-15)

- [ ] MEDIUM-001: 实现 httpOnly Cookie
- [ ] LOW-001: 开始 SQLModel 迁移

---

## 📊 优先级说明

### CRITICAL (紧急)

**定义**:
- 导致系统不可用
- 数据安全风险
- 用户无法使用核心功能

**响应时间**: 立即 (4 小时内)

### HIGH (高)

**定义**:
- 影响核心功能
- 性能严重下降
- 用户体验严重受损

**响应时间**: 1 天内

### MEDIUM (中)

**定义**:
- 不影响核心功能
- 有临时解决方案
- 技术债务或优化项

**响应时间**: 1 周内

### LOW (低)

**定义**:
- 代码风格问题
- 文档不完善
- 锦上添花的优化

**响应时间**: 1 个迭代内

---

## 🔍 问题搜索

### 按模块搜索

- **用户认证**: MEDIUM-001
- **WebSocket**: MEDIUM-002
- **测试**: MEDIUM-003
- **数据模型**: LOW-001
- **前端体验**: LOW-002
- **开发环境**: LOW-003

### 按负责人搜索

- **@backend-dev**: MEDIUM-001, MEDIUM-002, LOW-001
- **@frontend-dev**: MEDIUM-001, LOW-002
- **@whitebox-qa**: MEDIUM-003
- **@architect**: LOW-003

### 按版本搜索

- **v1.1.1**: MEDIUM-002, MEDIUM-003, LOW-003
- **v1.2.0**: MEDIUM-001, LOW-002
- **v1.3.0**: LOW-001

---

## 📞 联系方式

- **产品经理**: @pm
- **技术负责人**: @architect
- **问题反馈**: [GitHub Issues](https://github.com/your-org/sisyphus-x/issues)

---

## 📝 变更记录

| 日期 | 变更内容 | 变更人 |
|------|----------|--------|
| 2026-02-15 | 初始化已知问题清单 | @pm |
| 2026-02-15 | 从 CHANGELOG 迁移技术债务 | @pm |
| 2026-02-15 | 添加 MEDIUM-001 ~ MEDIUM-002 | @pm |
| 2026-02-15 | 添加 LOW-001 ~ LOW-003 | @pm |
| 2026-02-15 | 架构师审查后更新: 修正 CRITICAL-001/002 状态,添加 MEDIUM-003 | @pm + @architect |

---

**最后更新**: 2026-02-15 22:30
**下次评审**: 2026-02-22
