# 本地测试与集成计划

> 计划版本: v1.0
> 创建日期: 2025-02-11
> 创建人: Claude PM

---

## 用户决策

### 决策 1: 先本地检查
- **暂不推送到远程仓库**
- 先进行本地代码检查和测试
- 确认功能完整性后再推送

### 决策 2: 前端集成现在完成
- 补充执行日志组件
- 添加路由集成到 App.tsx

---

## 本地检查清单

### Phase 1: 前端补充功能（2.5 小时）

| 任务 | 负责人 | 预计时间 | 依赖 | 验收标准 |
|------|--------|----------|------|----------|
| **1.1 执行日志组件** | Frontend | 2 小时 | 无 | ✅ 默认隐藏<br>✅ 展开/收起切换<br>✅ 日志类型颜色正确<br>✅ 时间戳格式化 |
| **1.2 路由集成** | Frontend | 30 分钟 | 无 | ✅ App.tsx 路由配置<br>✅ /api/interfaces 可访问<br>✅ /api/interfaces/:id 可访问 |

#### 1.1 执行日志组件实现规范

**文件位置**: `frontend/src/pages/interface/components/ExecutionLog.tsx`

**接口定义**:
```tsx
interface LogEntry {
  timestamp: string    // "14:32:01.234"
  type: 'info' | 'success' | 'warning' | 'error'
  message: string
  details?: any       // 可选的详细数据
}

interface ExecutionLogProps {
  logs: LogEntry[]
  defaultExpanded?: boolean  // 默认 false
}
```

**UI 设计**:
```
展开状态:
┌─────────────────────────────────────────────────────────────────┐
│ 📋 执行日志                                    [收起 ▲]     │
│ ├─ 14:32:01.234  ℹ️  准备请求                                  │
│ ├─ 14:32:01.345  ✅ 替换环境变量: {{token}} → eyJhbGc...       │
│ ├─ 14:32:01.456  ℹ️  发送请求: GET /api/users                   │
│ ├─ 14:32:01.567  ℹ️  DNS 解析: 12.3ms                          │
│ ├─ 14:32:01.678  ℹ️  TCP 连接: 23.4ms                          │
│ ├─ 14:32:01.789  ℹ️  TTFB: 45.6ms                             │
│ └─ 14:32:01.890  ✅ 响应接收: 11.2ms (1.2KB)                 │
└─────────────────────────────────────────────────────────────────┘

收起状态:
┌─────────────────────────────────────────────────────────────────┐
│ Response                              [200 OK]    [125ms]    │
│                                        [▶ 展开日志]        │
└─────────────────────────────────────────────────────────────────┘
```

**颜色方案**:
- `info`: 蓝色 (text-blue-400)
- `success`: 绿色 (text-green-400)
- `warning`: 黄色 (text-yellow-400)
- `error`: 红色 (text-red-400)

**图标**:
- `info`: ℹ️ (Info)
- `success`: ✅ (CheckCircle)
- `warning`: ⚠️ (AlertTriangle)
- `error`: ❌ (XCircle)

#### 1.2 路由集成实现规范

**文件**: `frontend/src/App.tsx`

**实现步骤**:
1. 导入接口管理页面组件
2. 添加路由配置
3. 测试路由可访问性

**代码示例**:
```tsx
import InterfacePage from '@/pages/interface'

// 在路由配置中添加
<Route path="/api/interfaces" element={<InterfacePage />} />
<Route path="/api/interfaces/:id" element={<InterfacePage />} />
```

**测试步骤**:
1. 启动开发服务器: `npm run dev`
2. 访问 `http://localhost:5173/api/interfaces`
3. 确认页面正常渲染
4. 访问 `http://localhost:5173/api/interfaces/1`
5. 确认接口编辑器正常加载

---

### Phase 2: 本地代码检查（1 小时）

| 任务 | 负责人 | 预计时间 | 依赖 | 验收标准 |
|------|--------|----------|------|----------|
| **2.1 ESLint 检查** | Frontend | 15 分钟 | Phase 1 | ✅ 无 ESLint 错误 |
| **2.2 TypeScript 检查** | Frontend | 15 分钟 | Phase 1 | ✅ 无类型错误 |
| **2.3 构建测试** | Frontend | 15 分钟 | Phase 1 | ✅ `npm run build` 成功 |
| **2.4 代码格式化** | Frontend | 15 分钟 | Phase 1 | ✅ 代码符合 Prettier 规范 |

#### 检查命令

```bash
# 前端代码检查
cd frontend

# ESLint 检查
npm run lint

# TypeScript 检查
npx tsc --noEmit

# 构建测试
npm run build

# 代码格式化
npm run format
```

---

### Phase 3: 本地功能测试（2 小时）

| 任务 | 负责人 | 预计时间 | 依赖 | 验收标准 |
|------|--------|----------|------|----------|
| **3.1 目录树功能测试** | QA | 30 分钟 | Phase 1+2 | ✅ CRUD 操作正常<br>✅ 拖拽排序正常<br>✅ 搜索过滤正常 |
| **3.2 环境管理测试** | QA | 20 分钟 | Phase 1+2 | ✅ 环境切换正常<br>✅ 变量替换正常 |
| **3.3 请求编辑器测试** | QA | 30 分钟 | Phase 1+2 | ✅ 所有 Tab 正常<br>✅ 变量引用正常<br>✅ 文件上传正常 |
| **3.4 响应展示器测试** | QA | 20 分钟 | Phase 1+2 | ✅ 所有 Tab 正常<br>✅ 日志展开/收起正常 |
| **3.5 cURL 导入测试** | QA | 20 分钟 | Phase 1+2 | ✅ 解析准确率 > 95% |
| **3.6 执行日志测试** | QA | 10 分钟 | Phase 1+2 | ✅ 默认隐藏<br>✅ 展开/收起正常<br>✅ 颜色正确 |

#### 测试用例清单

**目录树功能测试**:
- [ ] 展开/折叠文件夹
- [ ] 搜索接口（实时）
- [ ] 新建文件夹
- [ ] 新建接口
- [ ] 重命名（右键菜单）
- [ ] 删除（带二次确认）
- [ ] 拖拽排序（同级）
- [ ] 拖拽移动（跨文件夹）

**环境管理测试**:
- [ ] 环境切换
- [ ] 新建环境
- [ ] 编辑环境变量
- [ ] 删除环境
- [ ] 变量引用（`{{}}` 语法）
- [ ] 系统变量（`{{$timestamp}}` 等）

**请求编辑器测试**:
- [ ] Method 选择器
- [ ] URL 输入（含变量）
- [ ] Params Tab（KV 编辑）
- [ ] Headers Tab（KV 编辑）
- [ ] Body Tab（JSON/form-data/raw）
- [ ] Auth Tab（Bearer/API Key/Basic Auth）
- [ ] Cookies Tab（KV 编辑）
- [ ] 文件上传（MinIO）

**响应展示器测试**:
- [ ] Body Tab（JSON 格式化）
- [ ] Headers Tab（KV 表格）
- [ ] Cookies Tab（解析展示）
- [ ] Timeline Tab（DNS/TCP/TTFB）
- [ ] **执行日志（展开/收起）**
- [ ] 状态码颜色

**cURL 导入测试**:
```bash
# 测试用例 1: 基本 GET 请求
curl https://api.example.com/users

# 测试用例 2: POST + Headers
curl -X POST https://api.example.com/users \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {{token}}" \
  -d '{"name":"Alice"}'

# 测试用例 3: form-data
curl -F "file=@test.jpg" \
  -F "name=test" \
  https://api.example.com/upload

# 测试用例 4: 复杂场景
curl -X POST https://api.example.com/data \
  -H "Content-Type: application/json" \
  -H "X-Custom-Header: value" \
  -d '{"key":"value"}' \
  --compressed
```

---

### Phase 4: 问题修复（1 小时）

| 任务 | 负责人 | 预计时间 | 依赖 | 验收标准 |
|------|--------|----------|------|----------|
| **4.1 修复功能缺陷** | Frontend | 30 分钟 | Phase 3 | ✅ 所有 P0/P1 缺陷修复 |
| **4.2 回归测试** | QA | 30 分钟 | 4.1 | ✅ 已修复问题不回归 |

---

## 验收标准

### 功能完整性

- [ ] 所有 P0 功能已实现（§6.1 验收清单）
- [ ] 执行日志默认隐藏，可展开
- [ ] 路由集成完成，可正常访问
- [ ] 用户决策符合（拖拽 P0，无 Pre-request Script）

### 代码质量

- [ ] 无 ESLint 错误
- [ ] 无 TypeScript 类型错误
- [ ] 构建成功
- [ ] 代码格式化

### 功能测试

- [ ] 所有测试用例通过
- [ ] 无 P0/P1 缺陷
- [ ] 用户体验流畅

---

## 时间估算

| Phase | 任务 | 预计时间 |
|-------|------|----------|
| Phase 1 | 前端补充功能 | 2.5 小时 |
| Phase 2 | 本地代码检查 | 1 小时 |
| Phase 3 | 本地功能测试 | 2 小时 |
| Phase 4 | 问题修复 | 1 小时 |
| **总计** | | **6.5 小时** |

---

## 下一步（完成本地检查后）

### 推送到远程

```bash
# 确认所有工作已完成
git status

# 添加修改的文件
git add frontend/src/

# 提交
git commit -m "feat: 完成接口管理模块前端开发

- ✅ 左侧目录树（含拖拽）
- ✅ 欢迎卡片
- ✅ 环境管理
- ✅ 变量引用
- ✅ 请求/响应编辑器
- ✅ cURL 导入
- ✅ 执行日志（按需显示）
- ✅ 路由集成
- ❌ Pre-request Script（已移除，符合用户决策）

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"

# 推送到远程（用户决策后执行）
git push origin feature/interface-refactor
```

### 前后端联调

等待后端 API 就绪后，进行完整联调测试。

---

**计划结束**
